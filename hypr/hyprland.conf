# ============================================
# HYPRLAND CONFIG - 4 MONITOR FIGHTER JET SETUP
# Catppuccin Mocha Theme
# ============================================

$mod = SUPER

# ============================================
# MONITORS - FIGHTER JET SETUP
# ============================================
# Layout: [HDMI-A-1: TVmonitor] [DP-1: leftMonitor] [DP-3: mainMonitor] [DP-2: rightMonitor]
# Updated: 2025-11-29 (main monitor moved to DP1 for boot priority)

# TVmonitor - Workspace 10
monitor=HDMI-A-1,3840x2160@60,0x0,2.0

# leftMonitor - Workspaces 1-3 (Ultrawide)
monitor=DP-1,3440x1440@180,0x1080,1.33

# mainMonitor - Workspaces 7-9 (QHD 240Hz)
monitor=DP-3,2560x1440@240,2586x1080,1

# rightMonitor - Workspaces 4-6 (Ultrawide)
monitor=DP-2,3440x1440@180,5146x1080,1.33

# Fallback for any unrecognized monitors
monitor=,preferred,auto,1

# ============================================
# WORKSPACE → MONITOR MAPPING
# Column 1:  1  2   3      4
#            L  M   R      TV
# Column 2:  5  6   7      8
# Column 3:  9 10  11     12
#
# DP-1 (left):      1, 5, 9
# DP-3 (main):      2, 6, 10
# DP-2 (right):     3, 7, 11
# HDMI-A-1 (TV):    4, 8, 12
# ============================================

# LEFT – DP-1
workspace = 1,  monitor:DP-1,     default:true
workspace = 5,  monitor:DP-1
workspace = 9,  monitor:DP-1

# MAIN (MIDDLE) – DP-3
workspace = 2,  monitor:DP-3,     default:true
workspace = 6,  monitor:DP-3
workspace = 10, monitor:DP-3

# RIGHT – DP-2
workspace = 3,  monitor:DP-2,     default:true
workspace = 7,  monitor:DP-2
workspace = 11, monitor:DP-2

# TV – HDMI-A-1
workspace = 4,  monitor:HDMI-A-1, default:true
workspace = 8,  monitor:HDMI-A-1
workspace = 12, monitor:HDMI-A-1

# ============================================
# APPEARANCE - CATPPUCCIN MOCHA
# ============================================
general {
    gaps_in = 6
    gaps_out = 12
    border_size = 3
    layout = dwindle

    # Catppuccin Mocha colors
    col.active_border = rgba(89b4faee) rgba(cba6f7ee) 45deg  # Blue → Mauve gradient
    col.inactive_border = rgba(181825aa)  # Mantle (dark)
}

decoration {
    rounding = 8

    blur {
        enabled = yes
        size = 6
        passes = 3
        new_optimizations = on
        ignore_opacity = on
    }

    shadow {
        enabled = yes
        range = 20
        render_power = 3
        color = rgba(11111bcc)  # Crust (darkest)
    }

    active_opacity = 1.0
    inactive_opacity = 0.95
}

animations {
    enabled = yes

    bezier = smooth, 0.05, 0.9, 0.1, 1.0
    bezier = overshot, 0.05, 0.9, 0.1, 1.1

    animation = windows, 1, 5, smooth, popin 80%
    animation = windowsOut, 1, 5, smooth, popin 80%
    animation = border, 1, 10, smooth
    animation = borderangle, 1, 8, smooth
    animation = fade, 1, 7, smooth
    animation = workspaces, 1, 6, smooth, slide
}

# ============================================
# INPUT
# ============================================
input {
    kb_layout = us
    follow_mouse = 1

    touchpad {
        natural_scroll = yes
        disable_while_typing = yes
        tap-to-click = yes
    }

    sensitivity = 0
    accel_profile = flat
}

# ============================================
# TABLET DEVICE MAPPING
# ============================================
# Map Xencelabs tablet to main monitor (DP-3: Acer X27U X2, 2560x1440@240Hz)
device {
    name = hanvon-ugee-xencelabs-pen-tablet-medium
    output = DP-3
}

misc {
    disable_hyprland_logo = true
    disable_splash_rendering = true
    focus_on_activate = true
    mouse_move_enables_dpms = true
    key_press_enables_dpms = true
    vfr = true
}

# ============================================
# LAYOUT
# ============================================
dwindle {
    pseudotile = yes
    preserve_split = yes
    smart_split = no
    smart_resizing = yes
}

# ============================================
# AUTOSTART
# ============================================
# Monitor configuration (ensure monitors are set up correctly on boot)
exec-once = ~/Desktop/main/scripts/set_hyprland_monitors.sh

# Core system components
exec-once = hyprpaper
exec-once = hyprpanel
# exec-once = waybar  # Replaced by HyprPanel
# exec-once = mako    # Replaced by HyprPanel notifications
exec-once = hypridle
exec-once = /usr/lib/polkit-kde-authentication-agent-1


# System tray applets
# exec-once = nm-applet --indicator      # Optional: HyprPanel has network menu
# exec-once = blueman-applet              # Optional: HyprPanel has bluetooth menu

# Thunar services
exec-once = thunar --daemon
exec-once = thunar-volman

# Blue light filter (adjust coordinates for your location)
# Default: San Francisco (-122.4, 37.8)
exec-once = wlsunset -l 37.8 -L -122.4

# Clipboard history (cliphist + wl-clip-persist)
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store
exec-once = wl-clip-persist --clipboard both

# Auto-start apps (user requested)
# exec-once = [workspace 11 silent] 1password  # REMOVED: Manual workspace placement
exec-once = 1password
exec-once = ~/.config/hypr/autostart.sh

# Optional: Start a system monitor on the TV
# exec-once = [workspace 10 silent] kitty --class btop -e btop

# ============================================
# MODAL NAVIGATION SUBMAPS
# ============================================
source = ~/.config/hypr/submaps.conf

# ============================================
# WISPRBRIDGE - VOICE INPUT
# ============================================
source = ~/.config/hypr/wisprbridge.conf

# ============================================
# KEYBINDS: APPS (CUSTOM LAYOUT)
# ============================================
# Core
bind = $mod, Return, exec, kitty
bind = CTRL ALT, T, exec, kitty  # Backup terminal keybind (doesn't rely on Super)
# Nexus Smart Launcher
bind = $mod, Space, exec, nexus

bind = $mod, E, exec, dolphin

bind = $mod, Q, killactive
bind = $mod, F, fullscreen
bind = $mod SHIFT, F, fullscreen, 1  # Maximize (keep gaps/bar)
bind = $mod, G, togglefloating
bind = $mod, T, togglesplit

# Clipboard management (cliphist + rofi - clipse has compatibility issue)
bind = $mod, V, exec, ~/.config/hypr/scripts/clipboard-rofi-only.sh         # Clipboard history picker (rofi)
bind = $mod, Y, exec, ~/.config/hypr/scripts/clipboard-quick-paste.sh       # Quick paste from history
bind = $mod SHIFT, B, exec, ~/.config/hypr/scripts/clipboard-type-paste.sh  # Type-paste mode (for stubborn apps) - moved from V for WisprBridge
bind = $mod, grave, exec, wl-paste | wl-copy                                 # Reload clipboard from selection

# Clipboard advanced operations
bind = $mod ALT, V, exec, ~/.config/hypr/scripts/clipboard-rofi-only.sh     # Pure rofi mode (fallback)
bind = $mod ALT, Y, exec, ~/.config/hypr/scripts/clipboard-pin.sh           # Pin current item
bind = $mod ALT, D, exec, ~/.config/hypr/scripts/clipboard-delete-item.sh   # Delete selected item
bind = $mod ALT, C, exec, ~/.config/hypr/scripts/clipboard-clear-sensitive.sh # Clear sensitive data

# Clipboard nuclear options
bind = $mod SHIFT ALT, V, exec, cliphist wipe && notify-send "Clipboard" "History wiped"
bind = $mod SHIFT ALT, C, exec, wl-copy -c && notify-send "Clipboard" "Clipboard cleared"

# bind = $mod SHIFT, R, exec, pkill waybar && waybar &  # Disabled: waybar replaced by HyperPanel
bind = $mod SHIFT, L, exec, hyprlock  # Lock screen - moved from F11 for WisprBridge
bind = $mod SHIFT, G, exec, ~/games/bin/gaming-mode  # Gaming Mode - moved from F12 for WisprBridge
bind = $mod SHIFT, Escape, exec, ~/.config/hypr/scripts/power-menu.sh

# Emergency modifier reset (fixes stuck Shift/Ctrl/Alt/Super keys)
bind = $mod SHIFT, BackSpace, exec, wtype -M shift -m shift -M ctrl -m ctrl -M super -m super -M alt -m alt && hyprctl dispatch submap reset && notify-send "Modifiers Reset" "All stuck keys released"

# Browsers
bind = $mod, B, exec, vivaldi-stable
bind = $mod SHIFT, B, exec, chromium

# Dev tools
bind = $mod, C, exec, cursor
bind = $mod SHIFT, C, exec, code

# Notes / Knowledge
bind = $mod, N, exec, obsidian
bind = $mod SHIFT, N, exec, notion

# Security / Passwords
bind = $mod, O, exec, 1password
bind = $mod, P, exec, 1password

# Planning / Email
bind = $mod, M, exec, vivaldi-stable --new-window https://mail.google.com
bind = $mod, A, exec, sunsama
bind = $mod, D, exec, todoist

# AI / LLM tools
bind = $mod, I, exec, claude-desktop-native
bind = $mod SHIFT, I, exec, assistant

# BizOps / Agents / CRM
bind = $mod, W, exec, vivaldi-stable --new-window "http://localhost:3001" "http://localhost:5678"

# ============================================
# KEYBINDS: WINDOW FOCUS & MOVEMENT
# ============================================
# Move focus with mod + H/J/K/L (Vim-style)
bind = $mod, H, movefocus, l
bind = $mod, L, movefocus, r
bind = $mod, K, movefocus, u
bind = $mod, J, movefocus, d

# Move windows with mod + Shift + H/J/K/L
bind = $mod SHIFT, H, movewindow, l
bind = $mod SHIFT, L, movewindow, r
bind = $mod SHIFT, K, movewindow, u
bind = $mod SHIFT, J, movewindow, d

# Resize windows with mod + Ctrl + H/J/K/L
bind = $mod CTRL, H, resizeactive, -40 0
bind = $mod CTRL, L, resizeactive, 40 0
bind = $mod CTRL, K, resizeactive, 0 -40
bind = $mod CTRL, J, resizeactive, 0 40

# Alternative: arrow keys
bind = $mod, left, movefocus, l
bind = $mod, right, movefocus, r
bind = $mod, up, movefocus, u
bind = $mod, down, movefocus, d

# ============================================
# MOVE WINDOW BETWEEN SCREENS WITH ARROWS
# mod + Shift + Arrow = send focused window
# ============================================
# Send to LEFT monitor (DP-1)
bind = $mod SHIFT, left,  movewindow, mon:DP-1

# Send to RIGHT monitor (DP-2)
bind = $mod SHIFT, right, movewindow, mon:DP-2

# Send to MAIN / CENTER monitor (DP-3)
bind = $mod SHIFT, down,  movewindow, mon:DP-3

# Send to TV (top) monitor (HDMI-A-1)
bind = $mod SHIFT, up,    movewindow, mon:HDMI-A-1

# ============================================
# KEYBINDS: WORKSPACES
# ============================================
# KEYBINDS: GLOBAL WORKSPACE SETS (SCENES)
# Super+1/2/3: switch ALL monitors in unison (DP-1, DP-3, DP-2, HDMI-A-1)

# Super+1 → Column 1: 1 (left), 2 (main), 3 (right), 4 (TV)
bind = $mod, 1, exec, sh -c ' \
  hyprctl dispatch focusmonitor DP-1;     hyprctl dispatch workspace 1;  \
  hyprctl dispatch focusmonitor DP-3;     hyprctl dispatch workspace 2;  \
  hyprctl dispatch focusmonitor DP-2;     hyprctl dispatch workspace 3;  \
  hyprctl dispatch focusmonitor HDMI-A-1; hyprctl dispatch workspace 4;  \
  hyprctl dispatch focusmonitor DP-3 \
'

# Super+2 → Column 2: 5 (left), 6 (main), 7 (right), 8 (TV)
bind = $mod, 2, exec, sh -c ' \
  hyprctl dispatch focusmonitor DP-1;     hyprctl dispatch workspace 5;  \
  hyprctl dispatch focusmonitor DP-3;     hyprctl dispatch workspace 6;  \
  hyprctl dispatch focusmonitor DP-2;     hyprctl dispatch workspace 7;  \
  hyprctl dispatch focusmonitor HDMI-A-1; hyprctl dispatch workspace 8;  \
  hyprctl dispatch focusmonitor DP-3 \
'

# Super+3 → Column 3: 9 (left), 10 (main), 11 (right), 12 (TV)
bind = $mod, 3, exec, sh -c ' \
  hyprctl dispatch focusmonitor DP-1;     hyprctl dispatch workspace 9;   \
  hyprctl dispatch focusmonitor DP-3;     hyprctl dispatch workspace 10;  \
  hyprctl dispatch focusmonitor DP-2;     hyprctl dispatch workspace 11;  \
  hyprctl dispatch focusmonitor HDMI-A-1; hyprctl dispatch workspace 12;  \
  hyprctl dispatch focusmonitor DP-3 \
'

# Move window to workspace: mod + Shift + [1-12]
bind = $mod SHIFT, 1, movetoworkspace, 1
bind = $mod SHIFT, 2, movetoworkspace, 2
bind = $mod SHIFT, 3, movetoworkspace, 3
bind = $mod SHIFT, 4, movetoworkspace, 4
bind = $mod SHIFT, 5, movetoworkspace, 5
bind = $mod SHIFT, 6, movetoworkspace, 6
bind = $mod SHIFT, 7, movetoworkspace, 7
bind = $mod SHIFT, 8, movetoworkspace, 8
bind = $mod SHIFT, 9, movetoworkspace, 9
bind = $mod SHIFT, 0, movetoworkspace, 10
bind = $mod SHIFT, minus, movetoworkspace, 11
bind = $mod SHIFT, equal, movetoworkspace, 12

# Move window to workspace silently: mod + Ctrl + [1-12]
bind = $mod CTRL, 1, movetoworkspacesilent, 1
bind = $mod CTRL, 2, movetoworkspacesilent, 2
bind = $mod CTRL, 3, movetoworkspacesilent, 3
bind = $mod CTRL, 4, movetoworkspacesilent, 4
bind = $mod CTRL, 5, movetoworkspacesilent, 5
bind = $mod CTRL, 6, movetoworkspacesilent, 6
bind = $mod CTRL, 7, movetoworkspacesilent, 7
bind = $mod CTRL, 8, movetoworkspacesilent, 8
bind = $mod CTRL, 9, movetoworkspacesilent, 9
bind = $mod CTRL, 0, movetoworkspacesilent, 10
bind = $mod CTRL, minus, movetoworkspacesilent, 11
bind = $mod CTRL, equal, movetoworkspacesilent, 12

# Special workspace (scratchpad)
bind = $mod, S, togglespecialworkspace, magic
bind = $mod SHIFT, S, movetoworkspace, special:magic

# ============================================
# KEYBINDS: VOLUME & BRIGHTNESS
# ============================================
bindle = , XF86AudioRaiseVolume, exec, pamixer -i 5
bindle = , XF86AudioLowerVolume, exec, pamixer -d 5
bindl = , XF86AudioMute, exec, pamixer -t
bindl = , XF86AudioMicMute, exec, pamixer --default-source -t

bindle = , XF86MonBrightnessUp, exec, brightnessctl set +5%
bindle = , XF86MonBrightnessDown, exec, brightnessctl set 5%-

# Media controls
bindl = , XF86AudioPlay, exec, playerctl play-pause
bindl = , XF86AudioPause, exec, playerctl play-pause
bindl = , XF86AudioNext, exec, playerctl next
bindl = , XF86AudioPrev, exec, playerctl previous

# ============================================
# KEYBINDS: SCREENSHOTS
# ============================================
# Fullscreen screenshot → Pictures
bind = $mod SHIFT, P, exec, grim ~/Pictures/Screenshots/$(date +%Y%m%d_%H%M%S).png

# Active window screenshot
bind = $mod CTRL, P, exec, grim -g "$(hyprctl activewindow -j | jq -r '.at,.size' | jq -s 'add | "\(.[0]),\(.[1]) \(.[2])x\(.[3])"')" ~/Pictures/Screenshots/$(date +%Y%m%d_%H%M%S).png

# ============================================
# MOUSE BINDS
# ============================================
bindm = $mod, mouse:272, movewindow
bindm = $mod, mouse:273, resizewindow

# ============================================
# WINDOW RULES
# ============================================
# Float specific apps
windowrulev2 = float, class:^(pavucontrol)$
windowrulev2 = float, class:^(blueman-manager)$
windowrulev2 = float, class:^(nm-connection-editor)$
windowrulev2 = float, title:^(Picture-in-Picture)$
windowrulev2 = float, class:^(imv)$
windowrulev2 = float, class:^(mpv)$

# Clipboard TUI (clipse)
windowrulev2 = float, class:^(clipboard-tui)$
windowrulev2 = size 1200 800, class:^(clipboard-tui)$
windowrulev2 = center, class:^(clipboard-tui)$
windowrulev2 = animation slide, class:^(clipboard-tui)$

# Pin picture-in-picture
windowrulev2 = pin, title:^(Picture-in-Picture)$

# Workspace defaults for 3-column layout
# ALL WORKSPACE ASSIGNMENT RULES REMOVED - Configure new rules below as needed
# Example: windowrulev2 = workspace 1, class:^(appname)$
# Example: windowrulev2 = workspace 2, title:^(.*Window Title.*)$

# Opacity rules
windowrulev2 = opacity 0.90 0.80, class:^(kitty)$
windowrulev2 = opacity 0.90 0.80, class:^(thunar)$
windowrulev2 = opacity 0.90 0.80, class:^(dolphin)$

# Idle inhibit (keep monitor on during media)
windowrulev2 = idleinhibit focus, class:^(mpv)$
windowrulev2 = idleinhibit fullscreen, class:^(firefox)$

# ===== GAMING =====
# Steam
# windowrulev2 = workspace 10, class:^(steam)$  # REMOVED: Manual workspace placement
# windowrulev2 = workspace 10, class:^(steamwebhelper)$  # REMOVED: Manual workspace placement
windowrulev2 = idleinhibit focus, class:^(steam_app_.*)$
windowrulev2 = fullscreen, class:^(steam_app_.*)$
windowrulev2 = immediate, class:^(steam_app_.*)$  # Disable VSync for games

# Gamescope
# windowrulev2 = workspace 10, class:^(gamescope)$  # REMOVED: Manual workspace placement
windowrulev2 = fullscreen, class:^(gamescope)$
windowrulev2 = immediate, class:^(gamescope)$
windowrulev2 = idleinhibit focus, class:^(gamescope)$

# Lutris / Heroic
# windowrulev2 = workspace 10, class:^(lutris)$  # REMOVED: Manual workspace placement
# windowrulev2 = workspace 10, class:^(heroic)$  # REMOVED: Manual workspace placement
windowrulev2 = idleinhibit focus, class:^(wine)$
windowrulev2 = immediate, class:^(wine)$

# Wine games
windowrulev2 = fullscreen, class:^(explorer.exe)$
windowrulev2 = immediate, class:^(\.exe)$

# ============================================
# LAYER RULES
# ============================================
layerrule = blur, waybar
layerrule = blur, rofi
layerrule = ignorezero, waybar
layerrule = ignorezero, rofi

# AGS Nexus glassmorphic blur
layerrule = blur, nexus-launcher
layerrule = ignorezero, nexus-launcher
layerrule = xray 0, nexus-launcher

# Nexus Smart Launcher glassmorphic blur
layerrule = blur, nexus
layerrule = ignorezero, nexus

# ============================================
# ENVIRONMENT VARIABLES
# ============================================
env = XCURSOR_SIZE,24
env = QT_QPA_PLATFORMTHEME,qt6ct
env = QT_QPA_PLATFORM,wayland;xcb
env = GDK_BACKEND,wayland,x11
env = SDL_VIDEODRIVER,wayland
env = CLUTTER_BACKEND,wayland
env = LANG,en_US.UTF-8
env = LC_ALL,en_US.UTF-8

# ===== NVIDIA GAMING OPTIMIZATIONS =====
env = LIBVA_DRIVER_NAME,nvidia
env = GBM_BACKEND,nvidia-drm
env = __GLX_VENDOR_LIBRARY_NAME,nvidia
env = WLR_NO_HARDWARE_CURSORS,1
env = PROTON_ENABLE_NVAPI,1
